
Начинаем пока с IDE
- [Developing Packages with RStudio](https://support.rstudio.com/hc/en-us/articles/200486488-Developing-Packages-with-RStudio)
- [STAT 545. Write your own R package](http://stat545.com/packages00_index.html)
- [STAT 545. Write your own R package, Part One](http://stat545.com/packages04_foofactors-package-01.html)
- [STAT 545. Write your own R package, Part Two](http://stat545.com/packages05_foofactors-package-02.html)
- [Making Your First R Package](http://tinyheero.github.io/jekyll/update/2015/07/26/making-your-first-R-package.html)
	- Each time you add new documentation to your R function, you need to run `devtools::document()` again to re-generate the `.Rd` files.

- Slides! [Package Building with devtools and usethis](colorado.rstudio.com/rsc/pkg-building). Tom Mock & Josiah Parry, 2021-10-21
github.com/jthomasmock/pkg-building
 
Загрузка с gitlab проводится такой командой:
`devtools::install_git("http://gitlab.com/ishutov/dvtdspack.git", credentials=git2r::cred_user_pass("username", "password"))`
Сверяем хэш локальной версии с тем, что `devtools` вписал в DESCRIPTION:
```
To get the full SHA:
$ git rev-parse HEADCdthztv
```
- [Sharing Internal R Packages](https://support.rstudio.com/hc/en-us/articles/115000239587-Sharing-Internal-R-Packages)
- Packrat. [How to Set Up a Custom CRAN-like Repository](https://rstudio.github.io/packrat/custom-repos.html)
- COOL! [Managing Private R Packages with Packrat and MiniCRAN](http://ellisvalentiner.com/post/2017-09-24-packrat-minicran/)
- [Using R with git and packrat](https://stackoverflow.com/questions/36187543/using-r-with-git-and-packrat)
- `packrat::opts$ignoredpackages("dvtdspack")` не особо помог. `packrat::init() стал собираться, но не более того. C GitHub пошло, с GitLab не работает.
- [Смотрим The Documentation Workflow](http://r-pkgs.had.co.nz/man.html#roxygen-comments). А еще одноименный параграф в pdf версии книги (стр. 44).
При первом запуске получили проблемы:
```
> devtools::document()
Updating dvtdspack documentation
Loading dvtdspack
First time using roxygen2. Upgrading automatically...
Updating roxygen version in D:\iwork.GL\dvtdspack/DESCRIPTION
Warning: The existing 'NAMESPACE' file was not generated by roxygen2, and will not be overwritten.
Warning messages:
1: In readLines(file) :
  incomplete final line found on 'D:\iwork.GL\dvtdspack/DESCRIPTION'
2: In readLines(file) :
  incomplete final line found on 'D:\iwork.GL\dvtdspack/DESCRIPTION'
```
Ситуация полностью описана здесь: [NAMESPACE not generated by roxygen2. Skipped. - Confusion with Hadley book](https://stackoverflow.com/questions/29135971/namespace-not-generated-by-roxygen2-skipped-confusion-with-hadley-book). 
Надо удалить файл `NAMESPACE`, который был создан скриптом IDE, а не roxygen.
- Держим в голове пакет [usethis](https://github.com/r-lib/usethis). The goal of usethis is to automate many common package and analysis setup tasks.
	- Добавляем пакеты для импорта: `usethis::use_package("checkmate")`, `usethis::use_package("stringi")`

Используем lintr для статической проверки кода:
jimhester/lintr](https://github.com/jimhester/lintr). Static Code Analysis for R.
	- [Lintr integration with RStudio](https://community.rstudio.com/t/lintr-integration-with-rstudio/1807)
```
library(lintr)
lintr::lint(path_to_script)
```
При этом кладем в локальную директорию файл `.lintr` с конфигурацией
- создаем тест командой `usethis::use_test("my-test")`
- Некоторые непонятки с вызовом функций внутри пакета. Политика партии разъясняется на странице 89 книги "R Packages".
```
It’s common for packages to be listed in Imports in DESCRIPTION, but not in
NAMESPACE. In fact, this is what I recommend: list the package in DESCRIPTION
so that it’s installed, then always refer to it explicitly with pkg::fun(). Unless there is
a strong reason not to, it’s better to be explicit. It’s a little more work to write, but a lot
easier to read when you come back to the code in the future. The converse is not true.
Every package mentioned in NAMESPACE must also be present in the Imports or
Depends fields.
```
- [“Documenting Multiple Functions in the Same File”] on page 55 "R Packages" for details.

- Описание полей в файле DESCRIPTION
	- [1.1.1 The DESCRIPTION file](https://cran.r-project.org/doc/manuals/r-release/R-exts.html)
	- [1.1.1 The `DESCRIPTION' file](http://www.hep.by/gnu/r-patched/r-exts/R-exts_4.html)
	- [R packages. Package metadata](http://r-pkgs.had.co.nz/description.html)

- Проблема "Failed to infer source for package 'dvtdspack'; using latest available version on CRAN instead" возникает еще на этапе сборки на локальной машине!. Связано это с `packrat::init()`. Подробный диалог ведется здесь: [Error adding packrat to existing project on MacOSX #314 {Open}](https://github.com/rstudio/packrat/issues/314) и здесь: [ Packrat does not download from a private repository on github #291 {Closed}](https://github.com/rstudio/packrat/issues/291)
1. Смотрим, что `packrat собирается компоновать: `packrat:::appDependencies()`
2. Ставим dev версию.

- ошибки с документированием.
	- При проверке пакета выскакивает ошибка "unexpected section header '\value'". Ответ искал здесь: [R github package w/ devtools: warning unknown macro '\item'](https://stackoverflow.com/questions/39670646/r-github-package-w-devtools-warning-unknown-macro-item). Но суть оказалась в другом.
Текст, включающий `%LIKE%` в файле .Rd, который по сути является LaTeX-форматоподобным, символ % является комментарием. Заэкранировал с помощью `\` и все стало ок.

- [How to Install R Packages from GitLab](https://blog.hasanbul.li/2018/07/09/how-to-install-r-packages-from-gitlab/)
- [Use of inline HTML is not currently supported #1115 {Closed}](https://github.com/r-lib/roxygen2/issues/1115)
- [R package workshop](https://combine-australia.github.io/r-pkg-dev/)


# Как избежать использования :: внутри пакетов
13.6.1 R functions
If you are using just a few functions from another package, my recommendation is to note the package name in the Imports: field of the DESCRIPTION file and call the function(s) explicitly using ::, e.g., pkg::fun().

If you are using functions repeatedly, you can avoid :: by importing the function with @importFrom pkg fun. This also has a small performance benefit, because :: adds approximately 5 µs to function evaluation time. Operators can also be imported in a similar manner, e.g., `@importFrom magrittr %>%`.

## function reexport
- [Magrittr %>% inside a package](https://community.rstudio.com/t/magrittr-inside-a-package/2033/11)
Have you tried adding `importFrom(magrittr,"%>%")` to NAMESPACE, or does that not beget the solution you're looking for?
Так делать не стоит, NAMESPACE генерируется roxygen. Лучше добавлять `@importFrom magrittr %>%`, см. https://stackoverflow.com/questions/27947344/r-use-magrittr-pipe-operator-in-self-written-package
but there could still be gotchas I'm missing. I think much safer would be to just define the same operator for the package
```
`%>%` <- magrittr::`%>%`
```
- [How to import more than 1 function via "@importFrom" in an ".R" file in R?](https://stackoverflow.com/questions/37138294/how-to-import-more-than-1-function-via-importfrom-in-an-r-file-in-r)
- [Introduction to roxygen2](https://cran.r-project.org/web/packages/roxygen2/vignettes/roxygen2.html)
- [Roxygen2 NAMESPACE tags](https://roxygen2.r-lib.org/articles/namespace.html)
- COOL! [R: use magrittr pipe operator in self written package](https://stackoverflow.com/questions/27947344/r-use-magrittr-pipe-operator-in-self-written-package). There's now an easier way to support the pipe in your packages. The wonderful package usethis has the function `use_pipe()`. You run that function once and it handles everything. This is how the `use_pipe()` function is described in the usethis documentation.
- [Re-export all objects from a package](https://community.rstudio.com/t/re-export-all-objects-from-a-package/4295)
- [14 Package evolution - changing stuff in your package](https://devguide.ropensci.org/evolution.html)
- [The NAMESPACE Workflow](https://r-pkgs.org/namespace.html#namespace-workflow) Generating the namespace with roxygen2 is just like generating function documentation with roxygen2. You use roxygen2 blocks (starting with #') and tags (starting with @). The workflow is the same:
	- Add roxygen comments to your .R files.
	- Run devtools::document() (or press Ctrl/Cmd + Shift + D in RStudio) to convert roxygen comments to .Rd files.
	- Look at NAMESPACE and run tests to check that the specification is correct.
	- Rinse and repeat until the correct functions are exported.

# UseThis
- [usethis](https://usethis.r-lib.org/index.html) is a workflow package: it automates repetitive tasks that arise during project setup and development, both for R packages and non-package projects.
- Slides. [You're Already Ready: Zen and the Art of R Package Development](https://malco.io/talk/you-re-already-ready-zen-and-the-art-of-r-package-development/)


- [Using the usethis Package and GitLab CI for Package Development in R: Part I](https://blog.methodsconsultants.com/posts/developing-r-packages-using-gitlab-ci-part-i/)
- [Using the usethis Package and GitLab CI for Package Development in R: Part II](https://blog.methodsconsultants.com/posts/developing-r-packages-with-usethis-and-gitlab-ci-part-ii/)
- [Using the usethis Package and GitLab CI for Package Development in R: Part III](https://blog.methodsconsultants.com/posts/developing-r-packages-with-usethis-and-gitlab-ci-part-iii/)
- COOL! [remotes](https://remotes.r-lib.org/). Install R Packages from GitHub, BitBucket, or other local or remote repositories
